@page "/"

@using CountdownTimer.Model;

<div class="container">
    <div class="row">
        <div class="col-lg-12">
            <div id="content">
                <h1><span class="oi oi-clock"></span> Countdown Timer</h1>

                <EditForm Model="@countdownTimerEvent" OnValidSubmit="@HandleValidSubmit">
                    <DataAnnotationsValidator />
                    <ValidationSummary />

                    <h3>
                        Date:
                        <InputDate id="date" DisplayName="Date" @bind-Value="countdownTimerEvent.Date" />
                    </h3>

                    <p>
                        <button type="submit">Start</button>
                    </p>

                    <hr>

                    <button class="btn btn-default btn-lg" type="submit">
                        <span>D: @countdownTimerEvent.TimeLeft.Days</span>
                        <span>H: @countdownTimerEvent.TimeLeft.Hours</span>
                        <span>M: @countdownTimerEvent.TimeLeft.Minutes</span>
                        <span>S: @countdownTimerEvent.TimeLeft.Seconds</span>
                    </button>
                </EditForm>

            </div>
        </div>
    </div>
</div>

@code {
    private CountdownTimer countdownTimerEvent = new();

    protected override void OnInitialized()
    {
        base.OnInitialized();

        countdownTimerEvent.OnTick += (s, e) => { InvokeAsync(StateHasChanged); };
    }

    private void HandleValidSubmit()
    {
        countdownTimerEvent.StartCountdown();
    }
}
